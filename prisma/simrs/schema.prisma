generator client {
    provider      = "prisma-client-js"
    output        = "../generated/simrs"
    binaryTargets = ["native", "linux-musl-arm64-openssl-3.0.x"]
}

datasource db {
    provider = "postgresql"
    url      = env("SIMRS_DATABASE_URL")
}

model PaymentMethod {
    id          Int     @id
    isEnabled   Boolean @map("statusenabled")
    displayName String  @map("reportdisplay")

    reservations Reservation[]

    @@map("kelompokpasien_m")
}

model Bed {
    id          Int     @id
    displayName String  @map("reportdisplay")
    bedNumber   Int     @map("nomorbed")
    isEnabled   Boolean @map("statusenabled")
    roomId      Int?    @map("objectkamarfk")
    bedStatusId Int?    @map("objectstatusbedfk")

    room      Room?      @relation(fields: [roomId], references: [id])
    bedStatus BedStatus? @relation(fields: [bedStatusId], references: [id])

    @@map("tempattidur_m")
}

model Room {
    id        Int     @id
    roomName  String  @map("namakamar")
    isEnabled Boolean @map("statusenabled")
    unitId    Int?    @map("objectruanganfk")
    classId   Int?    @map("objectkelasfk")

    unit  Unit?  @relation(fields: [unitId], references: [id])
    class Class? @relation(fields: [classId], references: [id])
    beds  Bed[]

    @@map("kamar_m")
}

model Unit {
    id           Int     @id
    unitName     String  @map("namaruangan")
    isEnabled    Boolean @map("statusenabled")
    departmentId Int?    @map("objectdepartemenfk")

    rooms           Room[]
    department      Department?      @relation(fields: [departmentId], references: [id])
    stockDetails    StockDetail[]
    doctorSchedules DoctorSchedule[]
    reservations    Reservation[]

    @@map("ruangan_m")
}

model BedStatus {
    id        Int     @id
    status    String  @map("statusbed")
    isEnabled Boolean @map("statusenabled")

    beds Bed[]

    @@map("statusbed_m")
}

model Class {
    id        Int     @id
    className String  @map("namakelas")
    isEnabled Boolean @map("statusenabled")

    rooms Room[]

    @@map("kelas_m")
}

model Department {
    id             Int     @id
    departmentName String  @map("namadepartemen")
    isEnabled      Boolean @map("statusenabled")

    units Unit[]

    @@map("departemen_m")
}

model Product {
    id          Int     @id
    productName String  @map("namaproduk")
    isEnabled   Boolean @default(true) @map("statusenabled")

    stockDetails StockDetail[]

    @@map("produk_m")
}

model ServiceReceipt {
    id        String   @id @map("norec")
    receiptAt DateTime @map("tglstruk")

    stockDetails StockDetail[]

    @@map("strukpelayanan_t")
}

model StockDetail {
    id              String    @id @map("norec")
    productId       Int       @map("objectprodukfk")
    unitId          Int       @map("objectruanganfk")
    receiptId       String    @map("nostrukterimafk")
    sourceProductId Int?      @map("objectasalprodukfk")
    netPrice        Float?    @map("harganetto2")
    discountPrice   Float?    @map("hargadiscount")
    quantity        Float     @map("qtyproduk")
    isEnabled       Boolean   @map("statusenabled")
    expiredAt       DateTime? @map("tglkadaluarsa")

    product Product        @relation(fields: [productId], references: [id])
    unit    Unit           @relation(fields: [unitId], references: [id])
    receipt ServiceReceipt @relation(fields: [receiptId], references: [id])

    @@map("stokprodukdetail_t")
}

model DoctorSchedule {
    id        Int      @id
    unitId    Int      @map("objectruanganfk")
    doctorId  Int      @map("objectpegawaifk")
    startTime DateTime @map("jammulai")
    endTime   DateTime @map("jamakhir")
    note      String?  @map("keterangan")
    days      String   @map("hari")
    quota     Int      @map("quota")
    isEnabled Boolean  @map("statusenabled")

    unit   Unit     @relation(fields: [unitId], references: [id])
    doctor Employee @relation(fields: [doctorId], references: [id])

    @@map("jadwaldokter_m")
}

model Employee {
    id         Int     @id
    fullName   String  @map("namalengkap")
    identityNo String? @map("noidentitas")
    isEnabled  Boolean @map("statusenabled")

    doctorSchedules DoctorSchedule[]
    reservations    Reservation[]

    @@map("pegawai_m")
}

model Reservation {
    id                   String   @id @map("norec")
    isEnabled            Boolean  @default(true) @map("statusenabled")
    unitId               Int      @map("objectruanganfk")
    identity             String   @map("noidentitas")
    queueNumber          Int      @map("noantrian")
    reservationNumber    String   @map("noreservasi")
    reservationDate      DateTime @map("tanggalreservasi")
    paymentMethodId      Int      @map("objectkelompokpasienfk")
    bpjsNumber           String?  @map("nobpjs")
    otherInsuranceNumber String?  @map("noasuransilain")
    createdAt            DateTime @default(now()) @map("tglinput")
    referralNumber       String?  @map("norujukan")
    doctorId             Int?     @map("objectpegawaifk")
    notes                String?  @map("keterangan")
    queueType            String   @map("jenis") // Format: EA001, EB001, dll
    referralSourceId     Int?     @default(0) @map("objectasalrujukanfk")
    isConfirmed          Boolean  @default(false) @map("isconfirm")
    callStatus           String   @default("0") @map("statuspanggil") // 0: belumdipanggil, 1: dipanggil, 2: sudahdipanggil
    isCancelled          Boolean  @default(false) @map("isbatal")
    cancelReason         String?  @map("keteranganbatal")
    // required in database
    educationId          Int?     @default(0) @map("objectpendidikanfk")
    type                 String?  @default("LAMA") @map("type")
    patientType          String?  @default("LAMA") @map("tipepasien")

    // Relations
    unit           Unit            @relation(fields: [unitId], references: [id])
    patient        Patient?        @relation(fields: [identity], references: [identity])
    paymentMethod  PaymentMethod   @relation(fields: [paymentMethodId], references: [id])
    doctor         Employee?       @relation(fields: [doctorId], references: [id])
    referralSource ReferralSource? @relation(fields: [referralSourceId], references: [id])

    @@map("antrianpasienregistrasi_t")
}

model Patient {
    id                   Int       @id
    isEnabled            Boolean   @default(true) @map("statusenabled")
    name                 String?   @map("namapasien")
    identity             String    @unique @map("noidentitas")
    genderId             Int?      @map("objectjeniskelaminfk")
    birthPlace           String?   @map("tempatlahir")
    birthDate            DateTime? @map("tgllahir")
    motherName           String?   @map("namaibu")
    fatherName           String?   @map("namaayah")
    spouseName           String?   @map("namasuamiistri")
    bpjsNumber           String?   @map("nobpjs")
    otherInsuranceNumber String?   @map("noasuransilain")
    phoneNumber          String?   @map("nohp")
    registeredAt         DateTime? @map("tgldaftar")
    homeAddress          String?   @map("alamatrmh")
    isSimkes             Boolean?  @default(true) @map("issimkes")
    // religionId           Int?      @map("objectagamafk")
    // bloodTypeId          Int?      @map("objectgolongandarahfk")
    // occupationId         Int?      @map("objectpekerjaanfk")
    // educationId          Int?      @map("objectpendidikanfk")
    // maritalStatusId      Int?      @map("objectstatusperkawinanfk")
    // titleId              Int?      @map("objecttitlefk")
    // deathDate            DateTime? @map("tglmeninggal")
    // nationalityId        Int?      @default(1) @map("objectkebangsaanfk")
    // countryId            Int?      @default(0) @map("objectnegarafk")
    // firstName            String?   @map("namadepan")
    // lastName             String?   @map("namabelakang")
    // birthTime            String?   @map("jamlahir")
    // familyName           String?   @map("namakeluarga")
    // guardianName         String?   @map("penanggungjawab")
    // guardianRelation     String?   @map("hubungankeluargapj")
    // guardianPhoneNumber  String?   @map("teleponpenanggungjawab")
    // photo                String?   @map("photo")
    // tribeId              Int?      @map("objectsukufk")
    // familyCardNumber     String?   @map("nomorkk")

    gender       Gender?       @relation(fields: [genderId], references: [id])
    reservations Reservation[]

    @@map("pasien_m")
}

model Gender {
    id        Int     @id
    gender    String  @map("jeniskelamin")
    isEnabled Boolean @map("statusenabled")

    patients Patient[]

    @@map("jeniskelamin_m")
}

model ReferralSource {
    id        Int     @id
    source    String  @map("asalrujukan")
    isEnabled Boolean @map("statusenabled")

    reservations Reservation[]

    @@map("asalrujukan_m")
}
